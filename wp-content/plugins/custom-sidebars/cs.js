function CsSidebar(t){this.id=t.split("%").join("\\%"),this.widgets="",this.name=trim(jQuery("#"+this.id).siblings(".sidebar-name").text()),this.description=trim(jQuery("#"+this.id).find(".sidebar-description").text());var e=jQuery("#cs-widgets-extra").find(".cs-edit-sidebar").clone();jQuery("#"+this.id).parent().append(e),e.find("a").each(function(){addIdToA(jQuery(this),t)})}function trim(t){t=t.replace(/^\s+/,"");for(var e=t.length-1;e>=0;e--)if(/\S/.test(t.charAt(e))){t=t.substring(0,e+1);break}return t}function getIdFromEditbar(t){return t.parent().siblings(".widgets-sortables").attr("id")}function addIdToA(t,e){t.attr("href",t.attr("href")+e)}function getSidebarTitle(t){return t+'<span><img src="images/wpspin_light.gif" class="ajax-feedback" title="" alt=""></span>'}function var_dump(t,e,i,n){var a,o,r="",s="";n||(n=1);for(var l=0;n>l;l++)s+="   ";if("object"!=typeof t)return a=t,"string"==typeof t&&("html"==e&&(a=a.replace(/&/g,"&amp;"),a=a.replace(/>/g,"&gt;"),a=a.replace(/</g,"&lt;")),a=a.replace(/\"/g,'"'),a='"'+a+'"'),"function"==typeof t&&e&&(a=new String(a).replace(/\n/g,"\n"+s),"html"==e&&(a=a.replace(/&/g,"&amp;"),a=a.replace(/>/g,"&gt;"),a=a.replace(/</g,"&lt;"))),"undefined"==typeof t&&(a="undefined"),"html"==e&&("string"!=typeof a&&(a=new String(a)),a=a.replace(/ /g,"&nbsp;").replace(/\n/g,"<br>")),a;for(var c in t){if(i&&n>i)a="*RECURSION*";else try{a=var_dump(t[c],e,i,n+1)}catch(d){continue}o=var_dump(c,e,i,n+1),r+=o+":"+a+",",e&&(r+="\n"+s)}return r=e?"{\n"+s+r.substr(0,r.length-(2+3*n))+"\n"+s.substr(0,s.length-3)+"}":"{"+r.substr(0,r.length-1)+"}","html"==e&&(r=r.replace(/ /g,"&nbsp;").replace(/\n/g,"<br>")),r}!function(t){function e(e,i){function n(){return d.update(),o(),d}function a(){var t=b.toLowerCase();g.obj.css(_,y/f.ratio),p.obj.css(_,-y),x.start=g.obj.offset()[_],f.obj.css(t,m[i.axis]),m.obj.css(t,m[i.axis]),g.obj.css(t,g[i.axis])}function o(){C?u.obj[0].ontouchstart=function(t){1===t.touches.length&&(r(t.touches[0]),t.stopPropagation())}:(g.obj.bind("mousedown",r),m.obj.bind("mouseup",l)),i.scroll&&window.addEventListener?(h[0].addEventListener("DOMMouseScroll",s,!1),h[0].addEventListener("mousewheel",s,!1)):i.scroll&&(h[0].onmousewheel=s)}function r(e){var i=parseInt(g.obj.css(_),10);x.start=v?e.pageX:e.pageY,w.start="auto"==i?0:i,C?(document.ontouchmove=function(t){t.preventDefault(),l(t.touches[0])},document.ontouchend=c):(t(document).bind("mousemove",l),t(document).bind("mouseup",c),g.obj.bind("mouseup",c))}function s(e){if(p.ratio<1){var n=e||window.event,a=n.wheelDelta?n.wheelDelta/120:-n.detail/3;y-=a*i.wheel,y=Math.min(p[i.axis]-u[i.axis],Math.max(0,y)),g.obj.css(_,y/f.ratio),p.obj.css(_,-y),(i.lockscroll||y!==p[i.axis]-u[i.axis]&&0!==y)&&(n=t.event.fix(n),n.preventDefault())}}function l(t){p.ratio<1&&(w.now=C?Math.min(m[i.axis]-g[i.axis],Math.max(0,w.start+(x.start-(v?t.pageX:t.pageY)))):Math.min(m[i.axis]-g[i.axis],Math.max(0,w.start+((v?t.pageX:t.pageY)-x.start))),y=w.now*f.ratio,p.obj.css(_,-y),g.obj.css(_,w.now))}function c(){t(document).unbind("mousemove",l),t(document).unbind("mouseup",c),g.obj.unbind("mouseup",c),document.ontouchmove=document.ontouchend=null}var d=this,h=e,u={obj:t(".viewport",e)},p={obj:t(".overview",e)},f={obj:t(".scrollbar",e)},m={obj:t(".track",f.obj)},g={obj:t(".thumb",f.obj)},v="x"===i.axis,_=v?"left":"top",b=v?"Width":"Height",y=0,w={start:0,now:0},x={},C="ontouchstart"in document.documentElement?!0:!1;return this.update=function(t){u[i.axis]=u.obj[0]["offset"+b],p[i.axis]=p.obj[0]["scroll"+b],p.ratio=u[i.axis]/p[i.axis],f.obj.toggleClass("disable",p.ratio>=1),m[i.axis]="auto"===i.size?u[i.axis]:i.size,g[i.axis]=Math.min(m[i.axis],Math.max(0,"auto"===i.sizethumb?m[i.axis]*p.ratio:i.sizethumb)),f.ratio="auto"===i.sizethumb?p[i.axis]/m[i.axis]:(p[i.axis]-u[i.axis])/(m[i.axis]-g[i.axis]),y="relative"===t&&p.ratio<=1?Math.min(p[i.axis]-u[i.axis],Math.max(0,y)):0,y="bottom"===t&&p.ratio<=1?p[i.axis]-u[i.axis]:isNaN(parseInt(t,10))?y:parseInt(t,10),a()},n()}t.tiny=t.tiny||{},t.tiny.scrollbar={options:{axis:"y",wheel:40,scroll:!0,lockscroll:!0,size:"auto",sizethumb:"auto"}},t.fn.tinyscrollbar=function(i){var n=t.extend({},t.tiny.scrollbar.options,i);return this.each(function(){t(this).data("tsb",new e(t(this),n))}),this},t.fn.tinyscrollbar_update=function(e){return t(this).data("tsb").update(e)}}(jQuery),CsSidebar.prototype.initDrag=function(t){var e,i;t("#widget-list").children(".widget").draggable("destroy").draggable({connectToSortable:"div.widgets-sortables",handle:"> .widget-top > .widget-title",distance:2,helper:"clone",zIndex:5,containment:"document",start:function(t,e){e.helper.find("div.widget-description").hide(),i=this.id},stop:function(){e&&t(e).hide(),e=""}}),t("#"+this.id).sortable({placeholder:"widget-placeholder",items:"> .widget",handle:"> .widget-top > .widget-title",cursor:"move",distance:2,containment:"document",start:function(t,e){e.item.children(".widget-inside").hide(),e.item.css({margin:"",width:""})},stop:function(n,a){if(a.item.hasClass("ui-draggable")&&a.item.data("draggable")&&a.item.draggable("destroy"),a.item.hasClass("deleting"))return wpWidgets.save(a.item,1,0,1),a.item.remove(),void 0;var o=a.item.find("input.add_new").val(),r=a.item.find("input.multi_number").val(),s=i,l=t(this).attr("id");return a.item.css({margin:"",width:""}),i="",o?("multi"==o?(a.item.html(a.item.html().replace(/<[^<>]+>/g,function(t){return t.replace(/__i__|%i%/g,r)})),a.item.attr("id",s.replace("__i__",r)),r++,t("div#"+s).find("input.multi_number").val(r)):"single"==o&&(a.item.attr("id","new-"+s),e="div#"+s),wpWidgets.save(a.item,0,0,1),a.item.find("input.add_new").val(""),a.item.find("a.widget-action").click(),void 0):(wpWidgets.saveOrder(l),void 0)},receive:function(e,i){if(""==i.sender[0].id)return csSidebars.showMessage(t("#oldbrowsererror").text(),!0),!1;var n=t(i.sender);t(this).is(":visible")&&-1==this.id.indexOf("orphaned_widgets")||n.sortable("cancel"),-1==n.attr("id").indexOf("orphaned_widgets")||n.children(".widget").length||n.parents(".orphan-sidebar").slideUp(400,function(){t(this).remove()})}}),t("div.widgets-sortables").sortable("option","connectWith","div.widgets-sortables").parent().filter(".closed").children(".widgets-sortables").sortable("disable"),t("#available-widgets").droppable("destroy").droppable({tolerance:"pointer",accept:function(e){return"widget-list"!=t(e).parent().attr("id")},drop:function(e,i){i.draggable.addClass("deleting"),t("#removing-widget").hide().children("span").html("")},over:function(e,i){i.draggable.addClass("deleting"),t("div.widget-placeholder").hide(),i.draggable.hasClass("ui-sortable-helper")&&t("#removing-widget").show().children("span").html(i.draggable.find("div.widget-title").children("h4").html())},out:function(e,i){i.draggable.removeClass("deleting"),t("div.widget-placeholder").show(),t("#removing-widget").hide().children("span").html("")}})},CsSidebar.prototype.remove=function(t){var e=this.id.split("\\").join(""),i=this.id,n={action:"cs-ajax",cs_action:"cs-delete-sidebar","delete":e,nonce:t("#_delete_nonce").val()};t.post(ajaxurl,n,function(e){e.success&&t("#"+i).parent().slideUp("fast",function(){t(this).remove()}),t("#_delete_nonce").val(e.nonce),csSidebars.showMessage(e.message,!e.success)})},CsSidebar.prototype.showEdit=function(t){var e=this.id.split("\\").join("");return editbar=t("#"+this.id).siblings(".cs-edit-sidebar"),this.editbar=editbar.html(),editbar.html(t("#cs-widgets-extra").find(".cs-cancel-edit-bar").html()),addIdToA(editbar.find(".cs-advanced-edit"),e),this.widgets=t("#"+this.id).detach(),editbar.before('<div id="'+e+'" class="widgets-sortables"></div>'),form=t("#cs-widgets-extra").find(".sidebar-form").clone(),form.find("form").addClass("cs-edit-form"),form.find(".sidebar_name").val(this.name).attr("id","edit_sidebar_name"),form.find(".sidebar_description").val(this.description).attr("id","edit_sidebar_description"),thiscs=this,form.find(".cs-create-sidebar").removeClass("cs-create-sidebar").addClass("cs-edit-sidebar").val(t("#cs-save").text()).attr("id","edit_sidebar_submit").on("click",function(){return thiscs.edit(t),!1}),editbar.siblings("#"+this.id).prepend(form),!1},CsSidebar.prototype.cancelEdit=function(t){editbar=t("#"+this.id).siblings(".cs-edit-sidebar"),editbar.html(this.editbar),editbar.siblings("#"+this.id).remove(),editbar.before(this.widgets)},CsSidebar.prototype.edit=function(t){var e="#"+this.id,i=this.id.split("\\").join(""),n=(this.id,{action:"cs-ajax",cs_action:"cs-edit-sidebar",sidebar_name:t("#"+this.id).find("#edit_sidebar_name").val(),sidebar_description:t("#"+this.id).find("#edit_sidebar_description").val(),cs_id:i,nonce:t("#_edit_nonce").val()});t.post(ajaxurl,n,function(n){n.success&&(sidebar=csSidebars.find(i),editbar=t(e).siblings(".cs-edit-sidebar"),t(e).remove(),editbar.before(sidebar.widgets),editbar.html(sidebar.editbar),t(e).find(".description").text(n.description),t(e).siblings(".sidebar-name").find("h3").html(getSidebarTitle(n.name))),t("#_edit_nonce").val(n.nonce),csSidebars.showMessage(n.message,!n.success)})},CsSidebar.prototype.showWhere=function(){},CsSidebar.prototype.where=function(){};var csSidebars,msgTimer;!function(t){csSidebars={sidebars:[],init:function(){csSidebars.scrollSetUp().addCSControls().showCreateSidebar().createCsSidebars().setEditbarsUp()},scrollSetUp:function(){return t("#widgets-right").addClass("overview").wrap('<div class="viewport" />'),t(".viewport").height(t(window).height()-60),t(".widget-liquid-right").height(t(window).height()).prepend('<div class="scrollbar"><div class="track"><div class="thumb"><div class="end"></div></div></div></div>').tinyscrollbar(),t(window).resize(function(){t(".widget-liquid-right").height(t(window).height()),t(".viewport").height(t(window).height()-60),t(".widget-liquid-right").tinyscrollbar_update("relative")}),t("#widgets-right").resize(function(){t(".widget-liquid-right").tinyscrollbar_update("relative")}),t(".widget-liquid-right").click(function(){setTimeout("csSidebars.updateScroll()",400)}),t(".widget-liquid-right").hover(function(){t(".scrollbar").fadeIn()},function(){t(".scrollbar").fadeOut()}),csSidebars},addCSControls:function(){return t("#cs-title-options").detach().prependTo("#widgets-right").show(),csSidebars},showCreateSidebar:function(){return t(".create-sidebar-button").click(function(){if(0==t("#new-sidebar-holder").length){var e=t("#cs-new-sidebar").clone(!0,!0).attr("id","new-sidebar-holder").hide().insertAfter("#cs-title-options");e.find("._widgets-sortables").addClass("widgets-sortables").removeClass("_widgets-sortables").attr("id","new-sidebar"),e.find(".sidebar-form").attr("id","new-sidebar-form"),e.find(".sidebar_name").attr("id","sidebar_name"),e.find(".sidebar_description").attr("id","sidebar_description"),e.find(".cs-create-sidebar").attr("id","cs-create-sidebar"),e.slideDown();var i=e.children(".sidebar-name");i.click(function(){var e=t(this).siblings(".widgets-sortables"),i=t(this).parent();i.hasClass("closed")?(i.removeClass("closed"),e.sortable("enable").sortable("refresh")):(e.sortable("disable"),i.addClass("closed"))}),csSidebars.setCreateSidebar()}else t("#cs-options").find(".ajax-feedback").css("visibility","hidden");return!1}),csSidebars},setCreateSidebar:function(){return t("#cs-create-sidebar").click(function(){var e={action:"cs-ajax",cs_action:"cs-create-sidebar",nonce:t("#_create_nonce").val(),sidebar_name:t("#sidebar_name").val(),sidebar_description:t("#sidebar_description").val()};return t("#new-sidebar-form").find(".ajax-feedback").css("visibility","visible"),t.post(ajaxurl,e,function(e){if(e.success){var i=t("#new-sidebar-holder");i.removeAttr("id").find(".sidebar-name h3").html(getSidebarTitle(e.name)),i.find("#new-sidebar").attr("id",e.id),i=t("#"+e.id).html('<p class="sidebar-description description">'+e.description+"</p>"),csSidebars.add(i.attr("id")).initDrag(t)}t("#_create_nonce").val(e.nonce),csSidebars.showMessage(e.message,!e.success),t("#new-sidebar-form").find(".ajax-feedback").css("visibility","hidden")},"json"),!1}),csSidebars},updateScroll:function(){t(".widget-liquid-right").tinyscrollbar_update("relative")},createCsSidebars:function(){return t("#widgets-right").find(".widgets-sortables").each(function(){"cs-"==t(this).attr("id").substr(0,3)&&csSidebars.add(t(this).attr("id"))}),csSidebars},setEditbarsUp:function(){return t("#widgets-right").on("click","a.delete-sidebar",function(){var e=trim(t(this).parent().siblings(".sidebar-name").text());return confirm(t("#cs-confirm-delete").text()+" "+e)&&csSidebars.find(t(this).parent().siblings(".widgets-sortables").attr("id")).remove(t),!1}),t("#widgets-right").on("click","a.edit-sidebar",function(){return id=getIdFromEditbar(t(this)),csSidebars.find(id).showEdit(t),!1}),t("#widgets-right").on("click","a.where-sidebar",function(){}),t("#widgets-right").on("click","a.cs-cancel-edit",function(){return id=getIdFromEditbar(t(this)),csSidebars.find(id).cancelEdit(t),t(this).parent().html(this.editbar),this.editbar="",!1}),csSidebars},showMessage:function(t,e){var i="cs-update";e&&(i="cs-error");var n=jQuery("#cs-message");if(0!=n.length)clearTimeout(msgTimer),n.removeClass("cs-error cs-update").addClass(i),n.text(t);else{var a='<div id="cs-message" class="cs-message '+i+'">'+t+"</div>";jQuery(a).hide().prependTo("#widgets-left").fadeIn().slideDown()}msgTimer=setTimeout("csSidebars.hideMessage()",7e3)},hideMessage:function(){jQuery("#cs-message").slideUp().remove()},find:function(t){return csSidebars.sidebars[t]},add:function(t){return csSidebars.sidebars[t]=new CsSidebar(t),csSidebars.sidebars[t]}},jQuery(function(t){t("#csfooter").hide(),t("#widgets-right").length>0&&csSidebars.init(),t(".defaultsContainer").hide(),t("#defaultsidebarspage").on("click",".csh3title",function(){t(this).siblings(".defaultsContainer").toggle()}),t("#widgets-right .widgets-sortables").on("sort",function(e,i){t("#widgets-right").top,i.position.top=-t("#widgets-right").css("top")}),t("#widgets-right .widget").on("sortstart",function(){})})}(jQuery);